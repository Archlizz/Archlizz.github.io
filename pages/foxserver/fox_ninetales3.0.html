<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fox3.0 服务端新特性 | Fox-Wikis</title>
    <meta name="description" content="全新的FOX">
    <link rel="icon" href="/app.ico">
    
    <link rel="preload" href="/assets/css/0.styles.d5b61a21.css" as="style"><link rel="preload" href="/assets/js/app.6be13b1b.js" as="script"><link rel="preload" href="/assets/js/2.cf95f4ea.js" as="script"><link rel="preload" href="/assets/js/30.8b9f22cc.js" as="script"><link rel="prefetch" href="/assets/js/10.6373c5aa.js"><link rel="prefetch" href="/assets/js/11.ce8823c8.js"><link rel="prefetch" href="/assets/js/12.369b204f.js"><link rel="prefetch" href="/assets/js/13.f191ade8.js"><link rel="prefetch" href="/assets/js/14.e133e94d.js"><link rel="prefetch" href="/assets/js/15.13c19680.js"><link rel="prefetch" href="/assets/js/16.99c95a04.js"><link rel="prefetch" href="/assets/js/17.ed98f0a2.js"><link rel="prefetch" href="/assets/js/18.c85ba4b9.js"><link rel="prefetch" href="/assets/js/19.fd53435f.js"><link rel="prefetch" href="/assets/js/20.c4327384.js"><link rel="prefetch" href="/assets/js/21.78f7cd1a.js"><link rel="prefetch" href="/assets/js/22.cb27264f.js"><link rel="prefetch" href="/assets/js/23.d5d46f2b.js"><link rel="prefetch" href="/assets/js/24.dcd5fa4c.js"><link rel="prefetch" href="/assets/js/25.f1e3a420.js"><link rel="prefetch" href="/assets/js/26.d18fdf33.js"><link rel="prefetch" href="/assets/js/27.d48d31d7.js"><link rel="prefetch" href="/assets/js/28.a6f9bb79.js"><link rel="prefetch" href="/assets/js/29.516fcfd7.js"><link rel="prefetch" href="/assets/js/3.4060668e.js"><link rel="prefetch" href="/assets/js/31.f0860eb1.js"><link rel="prefetch" href="/assets/js/32.5b7ff02c.js"><link rel="prefetch" href="/assets/js/33.9c96eb94.js"><link rel="prefetch" href="/assets/js/34.4b6ff991.js"><link rel="prefetch" href="/assets/js/35.4552b589.js"><link rel="prefetch" href="/assets/js/36.7e622afa.js"><link rel="prefetch" href="/assets/js/37.194204c8.js"><link rel="prefetch" href="/assets/js/38.4876a45a.js"><link rel="prefetch" href="/assets/js/39.00ee2908.js"><link rel="prefetch" href="/assets/js/4.0d44595b.js"><link rel="prefetch" href="/assets/js/40.6d9d5c8b.js"><link rel="prefetch" href="/assets/js/41.dd73d56e.js"><link rel="prefetch" href="/assets/js/42.c6aade2a.js"><link rel="prefetch" href="/assets/js/43.5f72f70e.js"><link rel="prefetch" href="/assets/js/44.c9419635.js"><link rel="prefetch" href="/assets/js/45.3b80c2ec.js"><link rel="prefetch" href="/assets/js/46.f0a3a65a.js"><link rel="prefetch" href="/assets/js/47.0d5660ce.js"><link rel="prefetch" href="/assets/js/48.c15f26f1.js"><link rel="prefetch" href="/assets/js/49.8d9e2667.js"><link rel="prefetch" href="/assets/js/5.eaf4b398.js"><link rel="prefetch" href="/assets/js/6.7a92b9fa.js"><link rel="prefetch" href="/assets/js/7.98a19337.js"><link rel="prefetch" href="/assets/js/8.66254435.js"><link rel="prefetch" href="/assets/js/9.0bb35de5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d5b61a21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Fox-Wikis</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/pages/foxserver/quickstart/新建服务.html" class="nav-link">Fox服务</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Android" class="dropdown-title"><span class="title">Android</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/android/fox2.0/Fox2.0平台环境准备.html" class="nav-link">FoxShell2.0</a></li><li class="dropdown-item"><!----> <a href="/pages/android/fox3.0/Fox3.0 android外壳新特性.html" class="nav-link">FoxShell3.0</a></li></ul></div></div><div class="nav-item"><a href="/pages/ios/Fox3.0 插件开发指南-IOS.html" class="nav-link">IOS</a></div><div class="nav-item"><a href="/pages/web/Fox2.0前端框架-工具介绍.html" class="nav-link">前端框架</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端组件" class="dropdown-title"><span class="title">前端组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/components/2.0/catButton.html" class="nav-link">2.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/components/1.0/" class="nav-link">1.0.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Archlizz/Archlizz.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jiangch316.github.io/fox_wikis.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/pages/foxserver/quickstart/新建服务.html" class="nav-link">Fox服务</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Android" class="dropdown-title"><span class="title">Android</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/android/fox2.0/Fox2.0平台环境准备.html" class="nav-link">FoxShell2.0</a></li><li class="dropdown-item"><!----> <a href="/pages/android/fox3.0/Fox3.0 android外壳新特性.html" class="nav-link">FoxShell3.0</a></li></ul></div></div><div class="nav-item"><a href="/pages/ios/Fox3.0 插件开发指南-IOS.html" class="nav-link">IOS</a></div><div class="nav-item"><a href="/pages/web/Fox2.0前端框架-工具介绍.html" class="nav-link">前端框架</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端组件" class="dropdown-title"><span class="title">前端组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/components/2.0/catButton.html" class="nav-link">2.0.0</a></li><li class="dropdown-item"><!----> <a href="/pages/components/1.0/" class="nav-link">1.0.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于作者" class="dropdown-title"><span class="title">关于作者</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Archlizz/Archlizz.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jiangch316.github.io/fox_wikis.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>FOX-SERVER</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>快速上手</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/foxserver/quickstart/新建服务.html" class="sidebar-link">新建服务</a></li><li><a href="/pages/foxserver/quickstart/过滤器.html" class="sidebar-link">过滤器</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>运行与维护</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/foxserver/fox_ninetales3.0.html" class="active sidebar-link">Fox3.0 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_1-服务请求" class="sidebar-link">1.服务请求</a></li><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_2-预启动服务" class="sidebar-link">2.预启动服务</a></li><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_3-扩展点" class="sidebar-link">3.扩展点</a></li><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_4-服务限流" class="sidebar-link">4.服务限流</a></li><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_5-服务降级" class="sidebar-link">5.服务降级</a></li><li class="sidebar-sub-header"><a href="/pages/foxserver/fox_ninetales3.0.html#_6-服务熔断" class="sidebar-link">6.服务熔断</a></li></ul></li><li><a href="/pages/foxserver/Session机制.html" class="sidebar-link">Session机制</a></li><li><a href="/pages/foxserver/配置参数.html" class="sidebar-link">配置参数</a></li><li><a href="https://ali.btop.mobi:4430/index.html" target="_blank" rel="noopener noreferrer" class="sidebar-link">Fox-API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="fox3-0-服务端新特性"><a href="#fox3-0-服务端新特性" class="header-anchor">#</a> Fox3.0 服务端新特性</h1> <p>标签（空格分隔）： server</p> <hr> <p></p><div class="table-of-contents"><ul><li><a href="#_1-服务请求">1.服务请求</a></li><li><a href="#_2-预启动服务">2.预启动服务</a></li><li><a href="#_3-扩展点">3.扩展点</a></li><li><a href="#_4-服务限流">4.服务限流</a></li><li><a href="#_5-服务降级">5.服务降级</a></li><li><a href="#_6-服务熔断">6.服务熔断</a></li></ul></div><p></p> <h2 id="_1-服务请求"><a href="#_1-服务请求" class="header-anchor">#</a> 1.服务请求</h2> <p>服务请求的URL格式修改
old：http://host:port/services/服务路径.do
new：http://host:port/工程名/服务路径.do</p> <h2 id="_2-预启动服务"><a href="#_2-预启动服务" class="header-anchor">#</a> 2.预启动服务</h2> <p>service配置文件中可设置onload配置，设置onload=true的service会在server启动的时候加载，调用该服务的init方法。当然改服务对象必须继承fox.ninetales.app.IService接口或其子类。</p> <blockquote><p>XML配置：</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!--继承的名字是文件名,继承的文件必须为abstract为true的文件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example<span class="token punctuation">&quot;</span></span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>boot<span class="token punctuation">&quot;</span></span> <span class="token attr-name">extends</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>filter-parser.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token comment">&lt;!-- boot测试 --&gt;</span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>boot<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>service.example.BootService<span class="token punctuation">&quot;</span></span>
    			<span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execute<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onload</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>package</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>Java代码：</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * Boot Service
     * @author 江成
     *
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BootService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JsonRequest</span><span class="token punctuation">,</span> <span class="token class-name">JsonResponse</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    
    	<span class="token comment">/**
    	 * 构造函数
    	 */</span>
    	<span class="token keyword">public</span> <span class="token class-name">BootService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	
    	<span class="token comment">/**
    	 * 初始化
    	 */</span>
    	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------------&gt; init &quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	
    	
    	<span class="token comment">/**
    	 * 销毁
    	 */</span>
    	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------------&gt; destory &quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    		
    	<span class="token punctuation">}</span>
    	
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="_3-扩展点"><a href="#_3-扩展点" class="header-anchor">#</a> 3.扩展点</h2> <p>服务提供和配置扩展点和获取扩展点的接口，以便于非平台层面能够处理层实现复杂的功能。扩展点配置目录为service/extension。</p> <blockquote><p>扩展点XML配置：</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--外设模块扩展--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>extension</span> <span class="token attr-name">point</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.extension.device<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--相机设备--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.device.system.camera.CameraDevice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camera<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>照相机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camera-default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>照相机<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--音频设备--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.device.system.media.MediaDevice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audio<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>录音机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audio-default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>录音机<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--视频设备--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.device.system.media.MediaDevice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>录像机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video-default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>录像机<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--签名板--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.device.system.writepad.WritePadDevice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sign<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>签名板<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sign-default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>签名板<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--系统相机设备--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fox.device.system.camera.CameraDevice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sys-camera<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>系统照相机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camera-sys<span class="token punctuation">&quot;</span></span> <span class="token attr-name">devName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>照相机<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>extension</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>java代码：</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token comment">//获取扩展点注册器</span>
	<span class="token class-name">ExtensionRegistry</span> extensionRegistry <span class="token operator">=</span> <span class="token class-name">ExtensionFacotry</span><span class="token punctuation">.</span><span class="token function">getExtensionRegistry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//获取扩展点</span>
	<span class="token class-name">IExtensionPoint</span> point <span class="token operator">=</span> extensionRegistry<span class="token punctuation">.</span><span class="token function">getExtensionPoint</span><span class="token punctuation">(</span><span class="token string">&quot;fox.extension.device&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>point <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;获取扩展点为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//获取扩展</span>
	<span class="token class-name">IExtension</span><span class="token punctuation">[</span><span class="token punctuation">]</span> extensions <span class="token operator">=</span> point<span class="token punctuation">.</span><span class="token function">getExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>extensions <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//循环获取扩展</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">IExtension</span> ext <span class="token operator">:</span> extensions<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">//获取配置</span>
			<span class="token class-name">IConfigElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> ext<span class="token punctuation">.</span><span class="token function">getConfigElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>items<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token class-name">IConfigElement</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> type <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> typeName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;typeName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> className <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;type=&quot;</span><span class="token operator">+</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;typeName=&quot;</span><span class="token operator">+</span>typeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;className=&quot;</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="_4-服务限流"><a href="#_4-服务限流" class="header-anchor">#</a> 4.服务限流</h2> <p>平台采用了令牌桶限流算法来实现限流控制（令牌桶会以一个恒定的速率向固定容量大小桶中放入令牌，当有浏览来时取走一个或者多个令牌,当发生高并发情况下拿到令牌的执行业务逻辑,没有获取到令牌的就会拒绝访问），默认令牌生成速率是500/second，也就是每秒访问次数不能超过500次。
服务限流的配置可以通过运维平台设置或者通过service.propoerties配置，如下</p> <pre><code>cn.com.bankit.phoenix.trade.server/RateLimitPermitsPerSecond=500
</code></pre> <h2 id="_5-服务降级"><a href="#_5-服务降级" class="header-anchor">#</a> 5.服务降级</h2> <p>服务压力剧增的时候，可以通过降低服务级别，让一部分服务暂时降级(运行该服务配置fallback服务),以保证核心任务的进行。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!-- demo测试 --&gt;</span> 	
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>service.example.DemoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execute<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 	 
    <span class="token comment">&lt;!--服务降级后执行服务--&gt;</span>	 	 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fallback</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>service.example.DemoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fallback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fallback</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_6-服务熔断"><a href="#_6-服务熔断" class="header-anchor">#</a> 6.服务熔断</h2> <p>服务熔断是指某个服务在一定的时间内连续或调用超时的情况下降低服务级别，转为调用fallback函数避免服务瘫痪。服务熔断和服务降级的区别是：前者是面向某个服务的，而且是在满足某种错误的情况下自动触发的；而服务降级是面向所有服务的，可以手工触发，也可以在达到指定条件后主动触发。
目前平台的熔断机制的默认条件是：
1、在请求数量到达20次的时候，检查在10秒内的服务错误率，如果服务请求的错误率达到50%就触发熔断。
2、距离触发熔断时间或上一次半熔断状态5秒后，进入半熔断状态，也就是让一个请求访问正常服务，如果该请求正常，则关闭熔断状态，否则继续开启熔断状态。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token comment">&lt;!-- demo测试 --&gt;</span> 	
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>service.example.DemoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execute<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 	 
    <span class="token comment">&lt;!--服务降级后执行服务--&gt;</span>	 	 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fallback</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>service.example.DemoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fallback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fallback</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><pre><code>熔断参数
#熔断机制是否开启
CircuitBreakerEnabled=true
#熔断统计窗口
CircuitBreakerBucketVolumeThreshold = 10
#熔断器开始统计错误率阀值
CircuitBreakerRequestVolumeThreshold = 20
#熔断器中断请求后会自动进入半打开状态的时间窗口
CircuitBreakerSleepWindow = 5000
#熔断开启错误率
CircuitBreakerErrorThresholdPercentage = 50
</code></pre></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于:</span> <span class="time">1/3/2020, 8:47:26 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/foxserver/运行维护/Fox服务器安装与维护.html" class="prev">安装</a></span> <span class="next"><a href="/pages/foxserver/Session机制.html">Session机制</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6be13b1b.js" defer></script><script src="/assets/js/2.cf95f4ea.js" defer></script><script src="/assets/js/30.8b9f22cc.js" defer></script>
  </body>
</html>
